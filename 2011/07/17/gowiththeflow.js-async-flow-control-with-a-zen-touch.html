<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>GoWithTheFlow.js - async flow control with a zen touch - for node and browser on Jerome Etienne blog</title>
	<meta name="author" content="Jerome Etienne" />
	
	
	<!-- syntax highlighting CSS -->
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<!-- Homepage CSS -->
	<link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
</head>
<body>
	
<style>
.announce {
	margin-bottom	: 2em;
	font-weight	: bold;	
	font-size	: 130%;
	background	: #020202;
	color		: #ccc;
	padding		: 15px;
	border-radius	: 20px;
	border		: solid;
	border-width	: 2px;
	border-color	: #888;
	text-shadow	: 0px 1px 0px #333;	
}
</style>

<div class="site">
	<div class="title">
		<a href="/">Jerome Etienne Notes</a>
		<div style="float: right;"> 
			<a href="/atom.xml">
				<img src='/static/images/feed-icon-28x28.png'/>
			</a>
			<a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script> 
		</div>
	</div>
	<div class="announce">
		Just released <a href="/2011/04/20/pacmaze-v2-even-more-WebGL-in-pacman.html">Pacmaze</a> my first WebGL game!
		<a href="http://pacmaze.com">Check it out!</a>
	</div>
  
	<div id="post">
  <h1><a href=''>GoWithTheFlow.js - async flow control with a zen touch - for node and browser</a></h1>
  <p class='meta'>
    2011-07-17
    
  </p>
  <p>GoWithTheFlow.js is a javascript asynchronous flow-control micro library which works <strong>in
node.js and in browser</strong>. It allow to control how your
asynchronous code is executed, sequentially or in parallel.
Flow() is only 30lines.</p>

<h1>How to use it</h1>

<p>Let start with a basic example. 2 jobs run in sequence. The first job is a timeout
so the result is delivered asynchronously, and a second job is run only <em>after</em> the
completion of the first.</p>

<pre><code>Flow().seq(function(next){
    console.log("step 1: started, it will last 1sec");
    setTimeout(function(){
        console.log("step 1: 1sec expired. Step 1 completed");
        next();
    }, 1000);
}).seq(function(next){
    console.log("step 2: run after step1 has been completed");
})
</code></pre>

<p>It will display the following</p>

<pre><code>step 1: started, it will last 1sec
step 1: 1sec expired. Step 1 completed
step 2: run after step1 has been completed
</code></pre>

<h1>Methods</h1>

<p>In order to keep it as simple as possible, Flow has only 2 methods.</p>

<h2>.seq(callback) to execute job sequentially</h2>

<p><code>.seq()</code> is used to execute functions sequentially. The <em>callback</em> parameter
will be executed only after all previous jobs are completed.
The callback signature is <code>callback(next, error, result)</code></p>

<ul>
<li><p><code>next(error, result)</code> is the function to call when the job is completed. <em>error</em> is to notify an error
to the next job. <em>result</em> to notify a result. <em>error</em> and <em>result</em> may be omitted, if so they are considered
equal to <code>undefined</code></p></li>
<li><p><code>error</code> is the error send by previous jobs</p></li>
<li><p><code>result</code> is the result send by previous jobs</p></li>
</ul>


<p>for example</p>

<pre><code>Flow().seq(function(next){
    console.log("first job");
    next(null, "result1");
}).seq(function(next, error, result){    
    console.log("second job. run *after* first job");
    next();
})
</code></pre>

<h2>.par(callback) to execute job in parallel</h2>

<p><code>.par()</code> is used to execute functions in parallel. The <em>callback</em> parameter is the same as for <code>.seq()</code>.
If multiple .par() are declared one after another, they are run in parallel. The first <code>.seq()</code> after them
will receive all the <em>error</em> and <em>result</em> in Array. One array item per previous <code>.par()</code></p>

<p>for example</p>

<pre><code>Flow().par(function(next){
    console.log("job foo");
    next(null, "foo");
}).par(function(next){
    console.log("job bar");
    next(null, "bar");
}).seq(function(next, errors, results){
    console.log("job run *after* the completion of foo and bar");
    console.assert(errors.length == 2 &amp;&amp; errors[0] === null &amp;&amp; errors[1] == null)
    console.assert(results.length == 2 &amp;&amp; results[0] === 'foo' &amp;&amp; results[1] == 'bar')
    next();
})
</code></pre>

<p>That's it</p>

<h1>Conclusion</h1>

<p>GoWithTheFlow.js is available on github <a href='https://github.com/jeromeetienne/gowiththeflow.js'>here</a>
under <a href='https://github.com/jeromeetienne/gowiththeflow.js/blob/master/MIT-LICENSE.txt'>MIT license</a>.
If you hit bugs, fill issues on github.
Feel free to fork, modify and have fun with it :)</p>

</div>

<div id="related">
	If you reached this point, maybe you want to share it:
	<a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
	<br/>	
	<br/>	
	<h2>Related Posts</h2>
	<ul class="posts">
		
			<li><span>05 Sep 2011</span> &raquo; <a href="/2011/09/05/microcache.js.html">microcache.js - cache micro library</a></li>
		
			<li><span>10 Jul 2011</span> &raquo; <a href="/2011/07/10/javascript-class-inheritance-ala-vaporjs-in-3-lines.html">Javascript Class Inheritance ala vapor.js in 3 lines</a></li>
		
			<li><span>26 May 2011</span> &raquo; <a href="/2011/05/26/Parisjs-7-slides.html">Parisjs 7 slides</a></li>
		
	</ul>
</div>



  
	<div class="footer">
		<div class="credits">
			<p>
				<a class="extra" href="http://jetienne.com">Homepage</a>
				|
				<a class="extra" href="http://jetienne.com">Twitter</a>
			</p>
		</div>
	</div>
</div>

<!-- google analytic -->
<script type="text/javascript">	
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-4037844-18']);
	_gaq.push(['_trackPageview']);
	
	(function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
 
<!-- follow me on twitter --> 
<a href="http://www.twitter.com/jerome_etienne"><img style="position: absolute; top: 10px; right: 10px; border: 0;" src="http://twitter-badges.s3.amazonaws.com/follow_me-c.png" alt="Follow jerome_etienne on Twitter"/></a>
<!-- github ribbon -->
<!--<a href="http://github.com/jeromeetienne"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://d3nwyuy0nl342s.cloudfront.net/img/ce742187c818c67d98af16f96ed21c00160c234a/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677261795f3664366436642e706e67" alt="Fork me on GitHub"></a>
--><!-- twitter profile widget -->
<style>
#twitterProfileWidget {
	position: fixed;
	bottom	: 0px;
	right	: 0px;
}
</style>
<div id="twitterProfileWidget">
	<script src="http://widgets.twimg.com/j/2/widget.js"></script>
	<script>
return;
	new TWTR.Widget({
		version: 2,
		type: 'profile',
		rpp: 4,
		interval: 6000,
		width: 250,
		height: 300,
		theme: {
			shell: {
				background: '#00a0d1',
				color: '#ffffff'
			},
			tweets: {
				background: '#c0deed',
				color: '#333333',
				links: '#00a0d1'
			}
		},
		features: {
			scrollbar: false,
			loop: false,
			live: false,
			hashtags: true,
			timestamp: true,
			avatars: false,
			behavior: 'all'
		}
	}).render().setUser('jerome_etienne').start();
	</script>
</div>




</body>
</html>
